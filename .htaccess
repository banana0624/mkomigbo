##  project-root/.htaccess ##
# Root-level router: send all web traffic to /public as the real web root

<IfModule mod_rewrite.c>
  RewriteEngine On

  # --------------------------------------------------------------------
  # 0) Security guard at project root: block direct access to private/vendor
  #    IF some misconfigured vhost ever points here directly.
  # --------------------------------------------------------------------
  RewriteRule ^(?:private|vendor)(/|$) - [F,L]

  # --------------------------------------------------------------------
  # 1) If the request is already under /public, or is an existing file/dir,
  #    then do NOTHING and let it be served as-is.
  # --------------------------------------------------------------------
  RewriteCond %{REQUEST_URI} ^/public/ [OR]
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # --------------------------------------------------------------------
  # 2) Otherwise, rewrite everything to /public/...
  #    Example: /staff/login  ->  /public/staff/login
  # --------------------------------------------------------------------
  RewriteRule ^(.*)$ /public/$1 [L]
</IfModule>

# --- Security: block sensitive things at the project root ---

# Never serve these config / backup style files directly, even if misrouted
<FilesMatch "^(?:\.env|composer\.(?:json|lock)|\.gitignore|.*\.(?:sql|sqlite|bak|ini))$">
  Require all denied
</FilesMatch>
