# project-root/public/.htaccess

# 1) Default index file for directories
DirectoryIndex index.php index.html

<IfModule mod_rewrite.c>
  RewriteEngine On

  # If your site is at the web root, keep "/".
  # If itâ€™s under a folder (e.g., http://host/mkomigbo/), set RewriteBase to "/mkomigbo/"
  RewriteBase /

  # Prevent Multiviews from hijacking clean URLs on some Apache setups
  Options -Multiviews

  # 2) Serve existing files/directories as-is (ALWAYS first)
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # 3) Public Subjects Router  (/subjects, /subjects/{subject}, /subjects/{subject}/{page})
  RewriteRule ^subjects/?$ staff/subjects/router.php [L,QSA]
  RewriteRule ^subjects/(.+)$ staff/subjects/router.php?path=$1 [L,QSA]

  # 4) Public Contributors Router
  RewriteRule ^contributors/?$ staff/contributors/router.php [L,QSA]
  RewriteRule ^contributors/(.+)$ staff/contributors/router.php?path=$1 [L,QSA]

  # 5) Public Platforms Router
  RewriteRule ^platforms/?$ staff/platforms/router.php [L,QSA]
  RewriteRule ^platforms/(.+)$ staff/platforms/router.php?path=$1 [L,QSA]

  # 6) Sitemaps + Robots (PHP handlers)
  RewriteRule ^sitemap-subjects\.xml$ sitemap-subjects.php [L]
  RewriteRule ^sitemap-contributors\.xml$ sitemap-contributors.php [L]
  RewriteRule ^sitemap-index\.xml$ sitemap-index.php [L]
  RewriteRule ^sitemap\.xml$ sitemap.php [L]
  RewriteRule ^robots\.txt$ robots.php [L]

  # 7) Optional clean URLs: map "/path" => "/path.php" (only if the PHP file exists)
  #    Example: /staff/login -> /staff/login.php
  RewriteCond %{REQUEST_FILENAME}.php -f
  RewriteRule ^(.+)$ $1.php [L]
</IfModule>
