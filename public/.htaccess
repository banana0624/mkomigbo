## project-root/public/.htaccess ##

# Use /public as the web root
Options -Indexes

<IfModule mod_rewrite.c>
  RewriteEngine On

  # --------------------------------------------------------------------
  # 1) Serve existing files/folders as-is
  # --------------------------------------------------------------------
  RewriteCond %{REQUEST_FILENAME} -f [OR]
  RewriteCond %{REQUEST_FILENAME} -d
  RewriteRule ^ - [L]

  # --------------------------------------------------------------------
  # 2) Pretty routes for STAFF
  #    /staff, /staff/, /staff/login, /staff/logout
  #    NOTE:
  #      - /staff/subjects/, /staff/pages/, /staff/contributors/, /staff/platforms/
  #        are handled by their own directories and index.php files,
  #        thanks to rule (1) above.
  # --------------------------------------------------------------------
  RewriteRule ^staff/?$          staff/index.php      [L,QSA]
  RewriteRule ^staff/login/?$    staff/login.php      [L,QSA]
  RewriteRule ^staff/logout/?$   staff/logout.php     [L,QSA]

  # --------------------------------------------------------------------
  # 3) Pretty routes for CONTRIBUTORS (public)
  #    /contributors, /contributors/
  # --------------------------------------------------------------------
  RewriteRule ^contributors/?$   contributors/index.php [L,QSA]

  # --------------------------------------------------------------------
  # 4) Pretty routes for PLATFORMS (public)
  #    /platforms, /platforms/
  # --------------------------------------------------------------------
  RewriteRule ^platforms/?$      platforms/index.php    [L,QSA]

  # --------------------------------------------------------------------
  # 5) Pretty routes for SUBJECTS (public)
  #    /subjects/
  #    /subjects/{subject}/
  #    /subjects/{subject}/{page}/
  # --------------------------------------------------------------------
  RewriteRule ^subjects/?$                 subjects/index.php                         [L,QSA]
  RewriteRule ^subjects/([^/]+)/?$         subjects/index.php?subject=$1              [L,QSA]
  RewriteRule ^subjects/([^/]+)/([^/]+)/?$ subjects/index.php?subject=$1&page=$2      [L,QSA]

  # --------------------------------------------------------------------
  # 6) Security hardening within /public
  #    Block traversal into private/vendor if a rewrite ever leaks
  # --------------------------------------------------------------------
  RewriteRule ^(?:../)*(?:private|vendor)(/|$) - [F,L]
</IfModule>

# ----------------------------------------------------------------------
# 7) Donâ€™t expose dotfiles or env
# ----------------------------------------------------------------------
<FilesMatch "^\.">
  Require all denied
</FilesMatch>

<Files ".env">
  Require all denied
</Files>

# ----------------------------------------------------------------------
# 8) Cache static assets sensibly (tune as you like)
# ----------------------------------------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType text/css               "access plus 7 days"
  ExpiresByType application/javascript "access plus 7 days"
  ExpiresByType image/svg+xml          "access plus 30 days"
  ExpiresByType image/png              "access plus 30 days"
  ExpiresByType image/jpeg             "access plus 30 days"
  ExpiresByType image/webp             "access plus 30 days"
</IfModule>
